---
apiVersion: v1
kind: ConfigMap
metadata:
  name: blocky-config
  namespace: blocky
  labels:
    app.kubernetes.io/name: blocky
data:
  config.yml: |
    # Blocky DNS Configuration

    # Upstream DNS servers
    upstream:
      default:
        - 1.1.1.1
        - 1.0.0.1
      timeout: 2s
      strategy: parallel_best

    # Custom DNS entries - loaded from separate ConfigMap
    customDNS:
      # Zone file is generated by blocky-dns-sync-job
      zone: |
        $INCLUDE /etc/blocky/custom-dns.zone

    # Blocking configuration
    blocking:
      blackLists:
        ads:
          # AdGuard DNS Filter
          - https://adguardteam.github.io/AdGuardSDNSFilter/Filters/filter.txt
          # EasyList
          - https://easylist.to/easylist/easylist.txt
          # Steven Black's Hosts
          - https://raw.githubusercontent.com/StevenBlack/hosts/master/hosts
          # OISD Full
          - https://big.oisd.nl/
      whiteLists:
        ads:
          # Add domains that should not be blocked
          - /^(.+[.])?(elmstreet79\.de)$/
      clientGroupsBlock:
        default:
          - ads
      blockType: zeroIp
      blockTTL: 1m
      refreshPeriod: 24h
      downloadTimeout: 5m
      downloadAttempts: 3
      downloadCooldown: 10s

    # Caching
    caching:
      minTime: 5m
      maxTime: 30m
      maxItemsCount: 10000
      prefetching: true
      prefetchExpires: 2h
      prefetchThreshold: 5
      prefetchMaxItemsCount: 1000

    # Redis for shared cache across replicas
    redis:
      address: redis:6379
      database: 0
      required: false
      connectionAttempts: 10
      connectionCooldown: 1s

    # Query logging
    queryLog:
      type: console
      logRetentionDays: 7

    # Prometheus metrics
    prometheus:
      enable: true
      path: /metrics

    # HTTP API
    httpPort: 4000

    # Log level
    logLevel: info
    logFormat: text
    logTimestamp: true
