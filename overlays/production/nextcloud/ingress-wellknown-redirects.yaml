---
# Redirect CalDAV/CardDAV well-known endpoints to Nextcloud DAV
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: nextcloud-wellknown-dav-redirects
  namespace: nextcloud
  annotations:
    nginx.ingress.kubernetes.io/permanent-redirect: https://$host/remote.php/dav
    nginx.ingress.kubernetes.io/permanent-redirect-code: "308"
spec:
  ingressClassName: nginx
  rules:
    - host: nextcloud.elmstreet79.de
      http:
        paths:
          - path: /.well-known/carddav
            pathType: Exact
            backend:
              service:
                name: nextcloud
                port:
                  number: 8080
          - path: /.well-known/caldav
            pathType: Exact
            backend:
              service:
                name: nextcloud
                port:
                  number: 8080
---
# Redirect host-meta to Nextcloud public.php
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: nextcloud-wellknown-host-meta-redirect
  namespace: nextcloud
  annotations:
    nginx.ingress.kubernetes.io/permanent-redirect: https://$host/public.php?service=host-meta
    nginx.ingress.kubernetes.io/permanent-redirect-code: "308"
spec:
  ingressClassName: nginx
  rules:
    - host: nextcloud.elmstreet79.de
      http:
        paths:
          - path: /.well-known/host-meta
            pathType: Exact
            backend:
              service:
                name: nextcloud
                port:
                  number: 8080
---
# Redirect host-meta.json to Nextcloud public.php
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: nextcloud-wellknown-host-meta-json-redirect
  namespace: nextcloud
  annotations:
    nginx.ingress.kubernetes.io/permanent-redirect: https://$host/public.php?service=host-meta-json
    nginx.ingress.kubernetes.io/permanent-redirect-code: "308"
spec:
  ingressClassName: nginx
  rules:
    - host: nextcloud.elmstreet79.de
      http:
        paths:
          - path: /.well-known/host-meta.json
            pathType: Exact
            backend:
              service:
                name: nextcloud
                port:
                  number: 8080
