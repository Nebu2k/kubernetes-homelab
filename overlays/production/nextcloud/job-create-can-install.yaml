---
# One-time job to create CAN_INSTALL file for Nextcloud initial setup
apiVersion: batch/v1
kind: Job
metadata:
  name: nextcloud-create-can-install
  namespace: nextcloud
spec:
  ttlSecondsAfterFinished: 300
  template:
    spec:
      restartPolicy: Never
      containers:
        - name: create-can-install
          image: busybox:latest
          command:
            - /bin/sh
            - -c
            - |
              touch /var/www/html/config/CAN_INSTALL
              echo "CAN_INSTALL file created successfully"
              ls -la /var/www/html/config/
          volumeMounts:
            - name: nextcloud-data
              mountPath: /var/www/html
              subPath: root
            - name: nextcloud-data
              mountPath: /var/www/html/data
              subPath: data
            - name: nextcloud-data
              mountPath: /var/www/html/config
              subPath: config
      volumes:
        - name: nextcloud-data
          persistentVolumeClaim:
            claimName: nextcloud-nextcloud
