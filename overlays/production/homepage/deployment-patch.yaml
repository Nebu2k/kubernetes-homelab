apiVersion: apps/v1
kind: Deployment
metadata:
  name: homepage
spec:
  template:
    spec:
      initContainers:
      - name: setup-proxmox-config
        image: busybox:latest
        command:
        - sh
        - -c
        - |
          cat > /app/config/proxmox.yaml << 'EOF'
          proxmox:
            url: https://192.168.2.8:8006
            token: ${HOMEPAGE_VAR_PROXMOX_USER}
            secret: ${HOMEPAGE_VAR_PROXMOX_PASS}
          EOF
        envFrom:
        - secretRef:
            name: homepage-proxmox
        volumeMounts:
        - name: homepage-base-config
          mountPath: /app/config
