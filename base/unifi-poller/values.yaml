# UniFi Poller Helm values
# Collects metrics from UniFi Controller for Prometheus

# Resources (conservative for Pi)
resources:
  requests:
    cpu: 50m
    memory: 64Mi
  limits:
    cpu: 200m
    memory: 128Mi

# Run on worker nodes only
nodeSelector:
  node-role.kubernetes.io/worker: "worker"

# Dashboards disabled (we manage them via kube-prometheus-stack)
dashboards:
  create: false

# Environment variables to inject credentials from sealed secret
# These override the config file values
env:
  - name: UP_UNIFI_DEFAULT_USER
    valueFrom:
      secretKeyRef:
        name: unifi-poller-credentials
        key: username
  - name: UP_UNIFI_DEFAULT_PASS
    valueFrom:
      secretKeyRef:
        name: unifi-poller-credentials
        key: password

# UnPoller configuration
# Credentials are injected via environment variables above
upConfig: |
  [poller]
      debug = false
      quiet = false
      plugins = []
      
  [prometheus]
      disable = false
      http_listen = "0.0.0.0:9130"
      report_errors = false
      namespace = "unifipoller"
      
  [influxdb]
      disable = true
      
  [loki]
      disable = true
      
  [unifi]
      dynamic = false
      
  [[unifi.controller]]    
      url         = "https://unifi.elmstreet79.de"
      # user/pass injected via UP_UNIFI_DEFAULT_USER and UP_UNIFI_DEFAULT_PASS env vars
      user        = "placeholder"
      pass        = "placeholder"
      sites       = ["all"]
      save_ids    = true
      save_dpi    = true
      save_sites  = true
      hash_pii    = false
      verify_ssl  = false
